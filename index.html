<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµé‡è®¡ç®—å™¨ - çº¿æ€§ vs å¹³æ–¹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(145deg, #eef2f8 0%, #e0e6f0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1000px;
            /* åŠ å®½ */
        }

        .card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 48px;
            box-shadow: 0 30px 50px rgba(0, 10, 30, 0.2), inset 0 1px 3px rgba(255, 255, 255, 0.9);
            padding: 36px 32px;
            border: 1px solid rgba(255, 255, 255, 0.7);
        }

        h1 {
            font-size: 2rem;
            font-weight: 600;
            color: #0b1a30;
            margin-bottom: 8px;
            letter-spacing: -0.02em;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .subtitle {
            color: #2c405e;
            font-size: 1rem;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(30, 60, 100, 0.15);
            margin-bottom: 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .badge {
            background: #1e324b;
            color: #b5ceff;
            padding: 6px 18px;
            border-radius: 40px;
            font-weight: 500;
            font-size: 0.9rem;
            box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.4);
        }

        .formula-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .formula-box {
            background: #d9e6f5;
            padding: 16px 20px;
            border-radius: 30px;
            text-align: center;
            font-weight: 500;
            color: #11315a;
            border: 1px solid #b7cef0;
            box-shadow: inset 0 1px 5px #a1b9dd;
            font-size: 1.1rem;
        }

        .formula-box.linear {
            background: #d9e6f5;
        }

        .formula-box.square {
            background: #ffe6cc;
            border-color: #ffb347;
        }

        .formula-box .square-badge {
            background: #ffb347;
            color: #1e3a5f;
            padding: 4px 12px;
            border-radius: 30px;
            font-weight: 700;
            margin-left: 8px;
            font-size: 0.9rem;
        }

        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 16px;
            margin-bottom: 30px;
        }

        .input-item {
            background: white;
            border-radius: 28px;
            padding: 10px 10px 10px 22px;
            box-shadow: 0 8px 18px rgba(27, 45, 75, 0.12), inset 0 1px 3px #ffffff, inset 0 0 0 1px #c5d4ee;
        }

        .input-label {
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #3d5a83;
            margin-bottom: 6px;
        }

        .input-field {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-field input {
            flex: 1;
            border: none;
            padding: 10px 6px 10px 0;
            font-size: 1.5rem;
            font-weight: 600;
            color: #0f2340;
            background: transparent;
            outline: none;
            width: 100%;
        }

        .input-field input::placeholder {
            color: #aebfdb;
            font-weight: 400;
            font-size: 1rem;
        }

        .unit-tag {
            background: #e2ebf9;
            padding: 8px 16px;
            border-radius: 30px;
            font-weight: 700;
            color: #1b3a62;
            font-size: 1rem;
            box-shadow: inset 0 1px 5px #adc2e0;
        }

        .info-panel {
            background: #d1def5;
            border-radius: 28px;
            padding: 20px 24px;
            margin: 25px 0 30px;
            box-shadow: inset 0 2px 8px #b1c2de, 0 8px 12px rgba(0, 0, 0, 0.05);
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #eef4fe;
            padding: 8px 18px;
            border-radius: 40px;
        }

        .info-item .label {
            font-weight: 600;
            color: #1c3453;
        }

        .info-item .value {
            background: #283e60;
            color: white;
            padding: 6px 20px;
            border-radius: 40px;
            font-weight: 700;
            font-size: 1.2rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .results-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .result-card {
            border-radius: 32px;
            padding: 24px;
            box-shadow: 0 20px 28px -12px rgba(0, 0, 0, 0.7), inset 0 1px 2px #7f9bc2;
        }

        .result-card.linear-card {
            background: linear-gradient(150deg, #142940, #0c1c32);
        }

        .result-card.square-card {
            background: linear-gradient(150deg, #4a2e1e, #2d1e12);
        }

        .result-title {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #9eb7de;
            font-weight: 500;
            margin-bottom: 15px;
        }

        .result-card.square-card .result-title {
            color: #ffd966;
        }

        .result-title .formula {
            background: #253c5c;
            color: #caddff;
            padding: 4px 12px;
            border-radius: 40px;
            font-size: 0.8rem;
        }

        .result-card.square-card .result-title .formula {
            background: #a5661b;
            color: #fff2d0;
        }

        .result-value {
            font-size: 2.3rem;
            font-weight: 700;
            color: white;
            line-height: 1.2;
            word-break: break-word;
            text-shadow: 0 3px 8px rgba(0, 0, 0, 0.6);
        }

        .result-desc {
            color: #8da4cf;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .result-card.square-card .result-desc {
            color: #ffd9a3;
        }

        .history-section {
            background: #eaf0fb;
            border-radius: 28px;
            padding: 22px;
            margin-top: 25px;
            border: 1px solid white;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .history-header h3 {
            color: #1d3657;
            font-size: 1.2rem;
        }

        .clear-btn {
            background: none;
            border: 2px solid #4e6b91;
            color: #2d4a73;
            padding: 6px 18px;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
        }

        .clear-btn:hover {
            background: #2d4a73;
            border-color: #2d4a73;
            color: white;
        }

        .history-list {
            list-style: none;
            max-height: 150px;
            overflow-y: auto;
        }

        .history-list li {
            background: white;
            border-radius: 40px;
            padding: 12px 18px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #b6cbef;
            box-shadow: 0 3px 8px #b1c4e3;
        }

        .history-list .hist-input {
            color: #314f7a;
            font-weight: 500;
        }

        .history-list .hist-result {
            font-weight: 700;
            color: #0a2345;
            margin-left: 15px;
        }

        .history-list .linear-result {
            color: #0a2345;
        }

        .history-list .square-result {
            color: #b45f06;
            margin-left: 10px;
        }

        .footer {
            text-align: center;
            color: #486185;
            font-size: 0.9rem;
            margin-top: 25px;
            padding-top: 18px;
            border-top: 2px dashed #b1c6e0;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="card">
            <h1>
                <span>ğŸ“Š æµé‡è®¡ç®—å™¨</span>
                <span
                    style="font-size: 0.9rem; background: #ffffff50; padding: 5px 15px; border-radius: 40px; margin-left: auto;">çº¿æ€§
                    vs å¹³æ–¹</span>
            </h1>
            <div class="subtitle">
                <span>ä¸¤ä¸ªå…¬å¼å¯¹æ¯” (å½“å‰å€¼, L, H)</span>
                <span class="badge">ç³»æ•° 13107 + 3276</span>
            </div>

            <!-- å…¬å¼è¯´æ˜ -->
            <div class="formula-row">
                <div class="formula-box linear">
                    ğŸ“ <strong>å…¬å¼ä¸€ (çº¿æ€§)</strong> (å½“å‰å€¼ - L) / (H - L) Ã— 13107 + 3276
                </div>
                <div class="formula-box square">
                    ğŸ“Š <strong>å…¬å¼äºŒ (å¹³æ–¹)</strong> [(å½“å‰å€¼ - L) / (H - L)]Â² Ã— 13107 + 3276
                    <span class="square-badge">Â²</span>
                </div>
            </div>

            <!-- ä¸‰ä¸ªè¾“å…¥æ¡† -->
            <div class="input-grid">
                <div class="input-item">
                    <div class="input-label">ğŸ“Ÿ å½“å‰å€¼</div>
                    <div class="input-field">
                        <input type="number" id="pvInput" value="5000" step="any">
                        <span class="unit-tag" id="pvDisplay">5000</span>
                    </div>
                </div>
                <div class="input-item">
                    <div class="input-label">ğŸ”½ Lå€¼</div>
                    <div class="input-field">
                        <input type="number" id="lInput" value="4000" step="any">
                        <span class="unit-tag" id="lDisplay">4000</span>
                    </div>
                </div>
                <div class="input-item">
                    <div class="input-label">ğŸ”¼ Hå€¼</div>
                    <div class="input-field">
                        <input type="number" id="hInput" value="10000" step="any">
                        <span class="unit-tag" id="hDisplay">10000</span>
                    </div>
                </div>
            </div>

            <!-- ä¸­é—´è®¡ç®—ä¿¡æ¯ -->
            <div class="info-panel">
                <div class="info-row">
                    <div class="info-item">
                        <span class="label">H - L</span>
                        <span class="value" id="rangeVal">6000</span>
                    </div>
                    <div class="info-item">
                        <span class="label">å½“å‰ - L</span>
                        <span class="value" id="deltaVal">1000</span>
                    </div>
                    <div class="info-item">
                        <span class="label">å½’ä¸€åŒ–</span>
                        <span class="value" id="normVal">0.1667</span>
                    </div>
                    <div class="info-item">
                        <span class="label">å¹³æ–¹å</span>
                        <span class="value" id="squaredVal">0.0278</span>
                    </div>
                </div>
            </div>

            <!-- ä¸¤ä¸ªç»“æœå¡ç‰‡ (çº¿æ€§ vs å¹³æ–¹) -->
            <div class="results-row">
                <div class="result-card linear-card">
                    <div class="result-title">
                        <span>ğŸ“ å…¬å¼ä¸€ (çº¿æ€§)</span>
                        <span class="formula">æ— å¹³æ–¹</span>
                    </div>
                    <div class="result-value" id="result1">13,110,276</div>
                    <div class="result-desc" id="desc1">ç›´æ¥å½’ä¸€åŒ– Ã— 13107 + 3276</div>
                </div>
                <div class="result-card square-card">
                    <div class="result-title">
                        <span>ğŸ“Š å…¬å¼äºŒ (å¹³æ–¹)</span>
                        <span class="formula">å…ˆå¹³æ–¹<span
                                style="background: #ffb347; color:#1e3a5f; padding:2px 8px; border-radius:20px; margin-left:5px;">Â²</span></span>
                    </div>
                    <div class="result-value" id="result2">3,641</div>
                    <div class="result-desc" id="desc2">å½’ä¸€åŒ–åå¹³æ–¹ Ã— 13107 + 3276</div>
                </div>
            </div>

            <!-- å†å²è®°å½• -->
            <div class="history-section">
                <div class="history-header">
                    <h3>ğŸ“‹ è®¡ç®—å†å² (åŒå‡»å¡ç‰‡ä¿å­˜)</h3>
                    <button class="clear-btn" id="clearHistoryBtn">æ¸…ç©ºè®°å½•</button>
                </div>
                <ul class="history-list" id="historyList">
                    <li>
                        <span class="hist-input">å½“å‰=5000 L=4000 H=10000</span>
                        <span>
                            <span class="hist-result linear-result">13,110,276</span>
                            <span class="hist-result square-result">| 3,641</span>
                        </span>
                    </li>
                </ul>
            </div>

            <div class="footer">
                âš¡ å®æ—¶è®¡ç®— Â· çº¿æ€§ä¸å¹³æ–¹å¯¹æ¯” Â· åŒå‡»ç»“æœä¿å­˜å†å²
            </div>
        </div>
    </div>

    <script>
        (function () {
            // è·å–å…ƒç´ 
            const pvInput = document.getElementById('pvInput');
            const lInput = document.getElementById('lInput');
            const hInput = document.getElementById('hInput');
            const pvDisplay = document.getElementById('pvDisplay');
            const lDisplay = document.getElementById('lDisplay');
            const hDisplay = document.getElementById('hDisplay');
            const rangeVal = document.getElementById('rangeVal');
            const deltaVal = document.getElementById('deltaVal');
            const normVal = document.getElementById('normVal');
            const squaredVal = document.getElementById('squaredVal');
            const result1 = document.getElementById('result1');
            const result2 = document.getElementById('result2');
            const desc1 = document.getElementById('desc1');
            const desc2 = document.getElementById('desc2');
            const historyList = document.getElementById('historyList');
            const clearBtn = document.getElementById('clearHistoryBtn');

            const MULT = 13107;
            const ADD = 3276;

            // å†å²è®°å½•
            let history = [];

            // åŠ è½½å†å²
            try {
                const saved = localStorage.getItem('flowCalcHistory');
                if (saved) {
                    history = JSON.parse(saved);
                } else {
                    history = [{ pv: 5000, l: 4000, h: 10000, linear: '13,110,276', square: '3,641' }];
                }
            } catch (e) {
                history = [{ pv: 5000, l: 4000, h: 10000, linear: '13,110,276', square: '3,641' }];
            }

            // æ ¼å¼åŒ–æ•°å­—
            function formatNumber(num) {
                if (isNaN(num) || !isFinite(num)) return 'é”™è¯¯';
                return num.toLocaleString('en-US', { maximumFractionDigits: 2, minimumFractionDigits: 0 });
            }

            // è®¡ç®—
            function calculate() {
                let pv = parseFloat(pvInput.value);
                let l = parseFloat(lInput.value);
                let h = parseFloat(hInput.value);

                // å¤„ç†NaN
                if (isNaN(pv)) pv = 0;
                if (isNaN(l)) l = 0;
                if (isNaN(h)) h = 1;

                // æ›´æ–°æ˜¾ç¤ºæ ‡ç­¾
                pvDisplay.textContent = pv;
                lDisplay.textContent = l;
                hDisplay.textContent = h;

                // é¿å…é™¤é›¶
                if (h === l) {
                    h = l + 1;
                    hInput.value = h;
                }

                // ä¸­é—´è®¡ç®—
                const range = h - l;
                const delta = pv - l;
                const norm = delta / range;
                const squared = norm * norm;  // å¹³æ–¹

                rangeVal.textContent = formatNumber(range);
                deltaVal.textContent = formatNumber(delta);
                normVal.textContent = norm.toFixed(4);
                squaredVal.textContent = squared.toFixed(4);

                // å…¬å¼ä¸€ (çº¿æ€§): norm Ã— MULT + ADD
                const linearResult = norm * MULT + ADD;
                // å…¬å¼äºŒ (å¹³æ–¹): squared Ã— MULT + ADD
                const squareResult = squared * MULT + ADD;

                const linearFormatted = formatNumber(linearResult);
                const squareFormatted = formatNumber(squareResult);

                result1.textContent = linearFormatted;
                result2.textContent = squareFormatted;

                desc1.textContent = `çº¿æ€§: ${norm.toFixed(4)} Ã— 13107 + 3276`;
                desc2.textContent = `å¹³æ–¹: ${squared.toFixed(4)} Ã— 13107 + 3276`;

                return { pv, l, h, linear: linearFormatted, square: squareFormatted };
            }

            // æ¸²æŸ“å†å²
            function renderHistory() {
                historyList.innerHTML = '';
                if (history.length === 0) {
                    historyList.innerHTML = '<li style="justify-content:center;">æš‚æ— å†å²è®°å½•</li>';
                    return;
                }
                history.slice(0, 10).forEach(item => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <span class="hist-input">å½“å‰=${item.pv} L=${item.l} H=${item.h}</span> 
                        <span>
                            <span class="hist-result linear-result">${item.linear}</span>
                            <span class="hist-result square-result"> | ${item.square}</span>
                        </span>
                    `;
                    historyList.appendChild(li);
                });
            }

            // æ·»åŠ åˆ°å†å²
            function addToHistory() {
                let pv = parseFloat(pvInput.value);
                let l = parseFloat(lInput.value);
                let h = parseFloat(hInput.value);

                if (isNaN(pv)) pv = 0;
                if (isNaN(l)) l = 0;
                if (isNaN(h)) h = 1;

                const range = h - l;
                const delta = pv - l;
                const norm = range !== 0 ? delta / range : 0;
                const squared = norm * norm;

                const linearResult = norm * MULT + ADD;
                const squareResult = squared * MULT + ADD;

                const linearFormatted = formatNumber(linearResult);
                const squareFormatted = formatNumber(squareResult);

                history.unshift({
                    pv, l, h,
                    linear: linearFormatted,
                    square: squareFormatted
                });

                if (history.length > 10) history.pop();

                try {
                    localStorage.setItem('flowCalcHistory', JSON.stringify(history));
                } catch (e) { }
                renderHistory();
            }

            // æ¸…ç©ºå†å²
            function clearHistory() {
                history = [];
                try {
                    localStorage.removeItem('flowCalcHistory');
                } catch (e) { }
                renderHistory();
            }

            // äº‹ä»¶ç»‘å®š
            pvInput.addEventListener('input', calculate);
            lInput.addEventListener('input', calculate);
            hInput.addEventListener('input', calculate);

            // åŒå‡»å¡ç‰‡ä¿å­˜å†å²
            document.querySelectorAll('.result-card').forEach(card => {
                card.addEventListener('dblclick', () => {
                    addToHistory();
                    card.style.transition = 'background 0.2s';
                    if (card.classList.contains('linear-card')) {
                        card.style.background = 'linear-gradient(150deg, #1e3a5a, #16344d)';
                        setTimeout(() => {
                            card.style.background = 'linear-gradient(150deg, #142940, #0c1c32)';
                        }, 200);
                    } else {
                        card.style.background = 'linear-gradient(150deg, #6b4f2e, #3d2e1a)';
                        setTimeout(() => {
                            card.style.background = 'linear-gradient(150deg, #4a2e1e, #2d1e12)';
                        }, 200);
                    }
                });
            });

            // å›è½¦ä¿å­˜å†å²
            [pvInput, lInput, hInput].forEach(input => {
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        addToHistory();
                    }
                });
            });

            clearBtn.addEventListener('click', clearHistory);

            // åˆå§‹åŒ–
            calculate();
            renderHistory();

            // é˜²é™¤é›¶
            hInput.addEventListener('blur', () => {
                let h = parseFloat(hInput.value);
                let l = parseFloat(lInput.value);
                if (h === l) {
                    alert('Hå’ŒLä¸èƒ½ç›¸ç­‰ï¼Œå·²è°ƒæ•´ä¸ºH = L + 1');
                    hInput.value = l + 1;
                    calculate();
                }
            });
        })();
    </script>
</body>

</html>